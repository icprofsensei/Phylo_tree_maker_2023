import numpy as np
from ete3 import TreeStyle, RectFace, faces, Tree, NodeStyle, TextFace
from ete3 import NCBITaxa
'''# aggregated counts
counts = np.array([0, 0, 486, 143, 8, 0, 3, 44, 0, 182, 12, 6, 11, 125, 0, 0, 81, 2, 6, 7, 71, 30, 1, 0, 4, 111, 0, 1, 18, 1, 0, 3, 19, 12, 37, 1, 0, 0, 2, 17, 3, 1, 25, 0, 1, 0, 22, 10, 2, 2, 0, 2, 8, 7, 15, 46, 4, 1, 1, 16, 97, 0, 2, 3, 0, 1, 1, 2, 43, 0, 7, 18, 5, 0, 11, 2, 26, 172, 0, 2, 28, 11, 21, 32, 0, 3, 16, 19, 27, 11, 24, 0, 0, 5, 1, 0, 17, 0, 0, 6, 1, 43, 6, 10, 29, 0, 0, 3, 1, 4, 0, 1, 3, 28, 16, 23, 6, 3, 0, 0, 0, 2, 2, 0, 5, 0, 0, 8, 0, 0, 1, 0, 5, 1, 0, 11, 3, 2, 0, 0, 7, 3, 1, 0, 1, 1, 0, 0, 0, 8, 0, 0, 1, 2, 5, 0, 0, 0, 0, 5, 0, 6, 30, 11, 0, 5, 27, 1, 3, 16, 4, 1, 7, 1, 56, 7, 0, 7, 0, 0, 0, 0, 1, 0, 0, 55, 15, 36, 2, 6, 10, 0, 0, 0, 0, 1, 8, 0, 5, 16, 0, 8, 31, 1, 0, 5, 1, 1, 0, 0, 1, 
1, 6, 0, 2, 2, 15, 0, 5, 2, 0, 9, 11, 2, 0, 1, 2, 2, 3, 4, 3, 2, 0, 3, 0, 3, 3, 0, 2, 0, 0, 1, 1, 3, 0, 0, 1, 0, 0, 1, 1, 1, 2, 1, 0, 1, 0, 1, 0, 38, 1, 1, 3, 1, 11, 0, 2, 0, 0, 0, 0, 31, 2, 0, 1, 0, 0, 0, 0, 0, 0, 4, 0, 0, 5, 0, 7, 0, 1, 0, 0, 9, 7, 0, 0, 0, 5, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 9, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 5, 0, 0, 0, 3, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 
10, 0, 3, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 10, 0, 1, 0, 2, 3, 0, 0, 2, 0, 0, 1, 0, 0, 1, 0, 1, 2, 1, 1, 0, 1, 3, 0, 1, 2, 0, 1, 0, 0, 1, 0, 0, 3, 3, 0, 1, 0, 0, 2, 1, 0, 0, 0, 2, 3, 0, 1, 0, 0, 1, 10, 5, 4, 0, 0, 3, 0, 3, 1, 0, 1, 0, 1, 2, 1, 1, 2, 1, 0, 1, 24, 4, 0, 1, 2, 0, 4, 3, 0, 0, 1, 2, 1, 0, 1, 7, 2, 0, 0, 0, 0, 0, 5, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 3, 1, 0, 0, 0, 1, 0, 0, 1, 3, 0, 1, 0, 0, 2, 4, 0, 0, 0, 1, 1, 0, 1, 1, 2, 0, 1, 1, 0, 0, 0, 1, 0, 2, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 2, 2, 0, 0, 0, 0, 0, 1, 7, 2, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 2, 32, 0, 0, 2, 1, 0, 1, 0, 0, 0, 1, 16, 0, 0, 0, 3, 1, 3, 2, 1, 7, 12, 3, 5, 3, 1, 0, 2, 0, 9, 12, 1, 0, 1, 1, 1, 2, 1, 1, 0, 0, 0, 1, 0, 3, 2, 3, 0, 0, 2, 0, 3, 0, 6, 2, 1, 0, 1, 1, 0, 0, 11, 0, 3, 0, 1, 4, 4, 1, 0, 6, 1, 3, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 5, 0, 2, 0, 1, 2, 2, 3, 0, 1, 0, 1, 2, 2, 2, 1, 4, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 11, 0, 1, 1, 0, 1, 0, 1, 6, 2, 7, 2, 0, 0, 1, 0, 3, 0, 0, 2, 3, 1, 0, 1, 1, 3, 0, 0, 4, 0, 0, 4, 1, 4, 1, 1, 1, 7, 6, 1, 5, 0, 1, 1, 1, 5, 1, 8, 0, 0, 0, 0, 4, 2, 1, 6, 1, 2, 1, 1, 0, 0, 0, 1, 6, 1, 3, 1, 3, 1, 0, 1, 1, 0, 1, 1, 4, 2, 2, 2, 0, 2, 4, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 4, 1, 1, 4, 2, 3, 2, 1, 1, 2, 1, 2, 1, 2, 1, 2, 0, 1, 2, 0, 1, 1, 0, 2, 4, 1, 1, 0, 1, 0, 0, 1, 0, 1, 2, 1, 1, 1, 1, 1, 0, 2, 2, 1, 1, 1, 0, 1, 1]).T
# taxonomic rank for each element in counts
taxrank = ['no rank', 'no rank', 'superkingdom', 'phylum', 'class', 'order', 'family', 'genus', 'clade', 'phylum', 'class', 'order', 'family', 'genus', 'clade', 'clade', 'phylum', 'class', 'order', 'family', 'genus', 'phylum', 'class', 'order', 'family', 'genus', 'order', 'family', 'genus', 'class', 'order', 'family', 'genus', 'family', 'genus', 'phylum', 'class', 'order', 'family', 'genus', 'species', 'order', 'family', 'genus', 'species', 'species group', 'species', 'superkingdom', 'phylum', 'class', 'clade', 'class', 'family', 'class', 'order', 'phylum', 'class', 'order', 'order', 'family', 'genus', 'order', 'family', 'genus', 'family', 'genus', 'order', 'family', 'genus', 'family', 'genus', 'family', 'genus', 'family', 'genus', 'genus', 'species', 'species', 'order', 'family', 'genus', 'genus', 'family', 'genus', 'order', 'family', 'genus', 'family', 'genus', 'family', 'genus', 'no rank', 'family', 'genus', 'class', 'order', 'family', 'class', 'order', 'family', 'species', 'species', 'phylum', 'family', 'genus', 'no rank', 'no rank', 'genus', 'family', 'genus', 'family', 'genus', 'genus', 'genus', 'genus', 'genus', 'genus', 'class', 'order', 'family', 'no rank', 'genus', 'genus', 'family', 'genus', 'order', 'family', 'genus', 'order', 'family', 'genus', 'family', 'genus', 'family', 'no rank', 'genus', 'genus', 'genus', 'order', 'family', 'genus', 'genus', 'genus', 'family', 'genus', 'genus', 'class', 'order', 'family', 'genus', 'order', 'family', 'genus', 'genus', 'genus', 'phylum', 'class', 'order', 'family', 'genus', 'family', 'genus', 'species', 'genus', 'genus', 'species', 'genus', 'species', 'family', 'genus', 'species', 'species', 'genus', 'species', 'species', 'species', 'clade', 'phylum', 'class', 'order', 'family', 'genus', 'species', 'superkingdom', 'clade', 'kingdom', 'genus', 'species', 'order', 'family', 'genus', 'phylum', 'class', 'order', 'family', 'genus', 'genus', 'order', 'family', 'genus', 'order', 'family', 'genus', 'class', 'order', 'family', 'genus', 'genus', 'order', 'family', 'genus', 'genus', 'genus', 'species group', 'species', 'family', 'genus', 'genus', 'species', 'species', 'family', 'genus', 'phylum', 'class', 'order', 'family', 'genus', 'species', 'phylum', 'phylum', 'phylum', 'phylum', 'clade', 'phylum', 'class', 'order', 'phylum', 'class', 'order', 'class', 'order', 'family', 'family', 'family', 'class', 'order', 'family', 'class', 'order', 'family', 'genus', 'genus', 'species', 'species', 'order', 'family', 'family', 'genus', 'genus', 'species', 'species', 'species', 'genus', 'genus', 'species', 'subkingdom', 'phylum', 'subphylum', 'class', 'order', 'family', 'genus', 'phylum', 'clade', 'subphylum', 'clade', 'clade', 'class', 'subclass', 'order', 'family', 'genus', 'subphylum', 'class', 'order', 'family', 'genus', 'subclass', 'order', 'suborder', 'family', 'genus', 'genus', 'clade', 'family', 'clade', 'genus', 'species', 'subphylum', 'class', 'subclass', 'order', 'suborder', 'family', 'genus', 'subphylum', 'class', 'order', 'family', 
'genus', 'no rank', 'genus', 'clade', 'class', 'subclass', 'order', 'family', 'genus', 'no rank', 'order', 'family', 'genus', 'no rank', 'phylum', 'subphylum', 'class', 'order', 'family', 'genus', 'order', 'family', 'genus', 'class', 'order', 'family', 'genus', 'subclass', 'order', 'family', 'genus', 'suborder', 'family', 'genus', 'class', 'order', 'family', 'genus', 'order', 'suborder', 'family', 'subfamily', 'genus', 'class', 'order', 'family', 'genus', 'class', 'order', 'family', 'genus', 'class', 'subclass', 'order', 'family', 'genus', 'subgenus', 'species', 'family', 'genus', 'subphylum', 'class', 'order', 'family', 'genus', 'phylum', 'subphylum', 'no rank', 'order', 'family', 'genus', 'family', 'genus', 'family', 'genus', 'family', 'genus', 'genus', 'order', 'family', 'genus', 'order', 'family', 'genus', 'suborder', 'family', 'genus', 'family', 'genus', 'species', 'species', 'species', 'species group', 'species', 'genus', 'family', 'genus', 'genus', 'section', 'species', 'order', 'family', 'genus', 'order', 'family', 'genus', 'species', 'family', 'genus', 'order', 'family', 'genus', 'genus', 'subclass', 'order', 'family', 'genus', 'species', 'genus', 'species', 'order', 'family', 'genus', 'genus', 'genus', 'family', 'order', 'family', 'genus', 'family', 'genus', 'genus', 'family', 'genus', 'genus', 'species', 'genus', 'species', 'species', 'family', 'genus', 'family', 'genus', 'species', 'species', 'genus', 'species', 'species', 'genus', 'species', 'species', 'family', 'genus', 'species', 'species', 'species', 'order', 'family', 'genus', 'genus', 'subphylum', 'class', 'order', 'suborder', 'family', 'genus', 'subgenus', 'species', 'order', 'family', 'genus', 'species', 'order', 'family', 'genus', 'no rank', 'species', 'species', 'species', 'order', 'family', 'genus', 'species', 'order', 'family', 'genus', 'species', 'no rank', 'species', 'family', 'genus', 'species', 'species', 'phylum', 'order', 'genus', 'species', 'species', 'family', 'genus', 'species', 'species', 'no rank', 'genus', 'species', 'subclass', 'order', 'family', 'genus', 'family', 
'genus', 'species', 'subclass', 'order', 'family', 'genus', 'species', 'genus', 'species', 'species', 'species', 'species', 'species', 'subphylum', 'class', 'order', 'family', 'genus', 'subgenus', 'species', 'species', 'species', 'species', 'species group', 'species', 'species', 'phylum', 'class', 'order', 'family', 'no rank', 'genus', 'species', 'family', 'family', 'genus', 'subclass', 'order', 'family', 'genus', 'genus', 'order', 'family', 'genus', 'genus', 
'species', 'species', 'genus', 'order', 'family', 'genus', 'genus', 'family', 'genus', 'order', 'family', 'genus', 'species', 'phylum', 'class', 'order', 'family', 'genus', 'genus', 'genus', 'genus', 'genus', 'genus', 'species', 'species', 'species', 'species', 'species', 'genus', 'species', 'family', 'genus', 'species', 'species', 'genus', 'species', 'species', 'genus', 'species', 'species', 'species', 'order', 'family', 'genus', 'species', 'family', 'genus', 'genus', 'genus', 'order', 'family', 'genus', 'genus', 'species', 'family', 'genus', 'genus', 'genus', 'family', 'genus', 'species', 'order', 'family', 'genus', 'order', 'family', 'no rank', 'genus', 'family', 'genus', 'family', 'no rank', 'genus', 'family', 'species', 'genus', 'species', 'family', 'genus', 'species', 'genus', 'no rank', 'clade', 'clade', 'clade', 'phylum', 'family', 'genus', 'order', 'family', 'genus', 'species', 'genus', 'genus', 'species', 'species group', 'species', 'species', 'phylum', 'genus', 'species', 'species', 'class', 'order', 'family', 'genus', 'species', 'species group', 'species', 'species group', 'species', 'species', 'species', 'genus', 'family', 'genus', 'species', 'species group', 'species', 'genus', 'species', 'species', 'genus', 'species', 'species', 'family', 'genus', 'species', 'family', 'genus', 'order', 'family', 'genus', 'genus', 'species', 'genus', 'species', 'genus', 'genus', 'order', 'family', 'genus', 'order', 'family', 'genus', 'genus', 'genus', 'genus', 'genus', 'species', 'genus', 'genus', 'species', 'genus', 'genus', 'species', 'species', 'species', 'species', 'species', 'phylum', 'clade', 'class', 'order', 'family', 'genus', 'genus', 'species', 'species', 'species', 'species', 'species', 'species', 'order', 'family', 'genus', 'species', 'genus', 'family', 'genus', 'genus', 'genus', 'genus', 'genus', 'species', 'genus', 'species group', 'species', 'species', 'species', 'species', 'species', 'species', 'genus', 'species', 'species', 'genus', 'species', 'genus', 'species', 'species', 'species', 'class', 'order', 'family', 'genus', 'phylum', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species', 'species group', 'species', 'species', 'species group', 'species', 'genus', 'no rank', 'genus', 'genus', 'genus', 'genus', 'no rank', 'genus', 'family', 'no rank', 'genus', 'no rank', 'genus', 'species', 'genus', 'genus', 'species', 'genus', 'species', 'family', 'genus', 'genus', 'species', 'species', 'genus', 'family', 'genus', 'genus']
txr = ['kingdom', 'no rank', 'subfamily', 'subphylum', 'superkingdom', 'species group', 'clade', 'family', 'species', 'suborder', 'subgenus', 'subclass', 'order', 'section', 'class', 'phylum', 'subkingdom', 'genus']
for rnk in txr:
    im = np.zeros(len(taxrank), dtype=int)
    for i, rnk2 in enumerate(taxrank):
        if rnk == rnk2:
            im[i] = 1
    n = np.sum(counts * im)
    k = im.sum()
    frac = 10
    nsamp = 99999 # number of resamplings, limits the lowest pseudo p-value that can be obtained
    R = np.zeros([nsamp, k]) # empirical estimate
    for j in np.arange(0,nsamp):
        r = np.random.choice(np.arange(1, k+1), int(np.ceil(n)), replace=True)
        u, rt = np.unique(r, return_counts=True)
        rt = np.divide(rt, np.sum(rt))
        R[j, u - 1] = rt * n
    r0 = counts[im == 1]
    pp = np.zeros(k) # pseudo p-values
    for j in np.arange(0,k):
        pp[j] = (np.count_nonzero(R[:, j] > r0[j]) + 1) / (nsamp + 1)
    print(pp)'''
weighteddict2 = {'1': 5.0, '131567': 5.0, '2': 4.694605198933568, '1224': 4.166331421766525, '1236': 3.7285924709428198, '72274': 0.43224307793373856, '135621': 3.8750612633917, '286': 3.92803582109974, '1783272': 5.0, '1239': 4.166331421766525, '91061': 3.7285924709428198, '186826': 3.6488033948702885, '1300': 3.8750612633917, '1301': 3.92803582109974, '1783270': 5.0, '68336': 5.0, '976': 4.166331421766525, '200643': 3.4275624752788385, '171549': 3.6488033948702885, '171552': 2.3262467840169627, '838': 3.92803582109974, '32066': 1.3272306390593718, '203490': 0.8276794032051507, '203491': 0.43224307793373856, '203492': 0.6368896597615535, '848': 3.92803582109974, '135625': 0.43224307793373856, '712': 0.13193840732039142, '724': 3.92803582109974, '909932': 1.4521306667695755, '1843489': 0.43224307793373856, '31977': 1.7073220787007846, '29465': 3.92803582109974, '171551': 3.8750612633917, '836': 3.92803582109974, '29547': 0.02666942833751868, '3031852': 0.25456172918185765, '213849': 0.43224307793373856, '72293': 0.13193840732039142, '209': 2.9301088297226054, '32025': 0.059428268603539273, '91347': 3.6488033948702885, '543': 3.8750612633917, '544': 0.042648502424435415, '67825': 0.059428268603539273, '136841': 5.0, '287': 3.753978051627641, '2157': 0.17172645365323114, '57723': 0.02666942833751868, '28216': 0.43935045837568626, '68525': 5.0, '28221': 0.43935045837568626, '815': 3.8750612633917, '186801': 3.4275624752788385, '186802': 3.6488033948702885, '201174': 4.166331421766525, '1760': 1.4521306667695755, '1385': 0.43224307793373856, '80840': 0.43224307793373856, 
'90964': 3.8750612633917, '1279': 3.92803582109974, '85006': 0.43224307793373856, '1268': 0.13193840732039142, '1269': 0.042648502424435415, '85019': 0.13193840732039142, '1696': 0.042648502424435415, '85007': 0.43224307793373856, '1653': 0.13193840732039142, '1716': 3.92803582109974, '186817': 0.13193840732039142, '1386': 0.042648502424435415, '80864': 3.8750612633917, '34072': 0.042648502424435415, '1129771': 0.13193840732039142, '32067': 0.7278322241038939, '80865': 0.042648502424435415, '1282': 3.753978051627641, '1280': 3.753978051627641, '85009': 0.43224307793373856, '31957': 0.13193840732039142, '1743': 3.92803582109974, '32207': 3.92803582109974, '216572': 3.8750612633917, '216851': 3.92803582109974, '85004': 0.43224307793373856, '31953': 3.8750612633917, '1678': 3.92803582109974, '186803': 3.8750612633917, '572511': 3.92803582109974, '186804': 3.8750612633917, '1257': 3.92803582109974, '538999': 5.0, '543314': 0.13193840732039142, '86331': 3.92803582109974, '526524': 0.25456172918185765, '526525': 0.43224307793373856, '128827': 3.8750612633917, '84998': 0.25456172918185765, '84999': 0.43224307793373856, '84107': 1.7073220787007846, '40520': 0.059428268603539273, '851': 3.753978051627641, '508458': 0.02666942833751868, '33958': 3.8750612633917, '816': 3.92803582109974, '539002': 5.0, '539738': 5.0, '1378': 0.042648502424435415, '186828': 0.13193840732039142, '117563': 0.042648502424435415, '1903414': 3.8750612633917, '581': 0.042648502424435415, '46205': 0.042648502424435415, '1578': 3.92803582109974, '841': 3.92803582109974, '189330': 3.92803582109974, '33042': 0.042648502424435415, '28211': 0.8276794032051507, '356': 0.43224307793373856, '118882': 0.13193840732039142, '2826938': 5.0, '528': 0.042648502424435415, '577309': 0.042648502424435415, '2005525': 0.13193840732039142, '375288': 0.042648502424435415, '1843488': 0.43224307793373856, '909930': 0.13193840732039142, '33024': 0.042648502424435415, '204441': 0.43224307793373856, '433': 0.13193840732039142, '50709': 0.042648502424435415, '119045': 0.13193840732039142, '407': 0.042648502424435415, '506': 0.13193840732039142, '2890311': 5.0, '570': 3.92803582109974, '44259': 0.042648502424435415, '43996': 0.4801322484101918, '909929': 0.43224307793373856, '1843491': 3.8750612633917, '970': 0.042648502424435415, '28050': 3.92803582109974, '207244': 0.042648502424435415, '2810280': 0.13193840732039142, '135858': 3.92803582109974, '2701': 0.042648502424435415, '1737404': 0.25456172918185765, '1737405': 0.43224307793373856, '1570339': 0.6368896597615535, '165779': 0.042648502424435415, '1643822': 0.8162944821640523, '1643826': 0.13193840732039142, '84108': 0.042648502424435415, '244127': 0.042648502424435415, '102106': 0.042648502424435415, '200940': 0.02666942833751868, '3031449': 0.43935045837568626, '213115': 0.43224307793373856, '194924': 0.13193840732039142, '872': 0.042648502424435415, '186806': 0.13193840732039142, '1730': 0.042648502424435415, '817': 3.753978051627641, '1263': 3.92803582109974, '2316020': 0.042648502424435415, '33038': 0.059428268603539273, '543311': 3.92803582109974, '47678': 0.059428268603539273, '31979': 3.8750612633917, '1485': 2.552372207138855, '856': 0.059428268603539273, '371601': 0.059428268603539273, '39948': 0.042648502424435415, '39950': 0.059428268603539273, '837': 3.753978051627641, '853': 0.059428268603539273, '1798711': 5.0, '1117': 0.02666942833751868, '3028117': 0.25456172918185765, '2881377': 0.43224307793373856, '1890438': 0.13193840732039142, '1005722': 0.042648502424435415, '128142': 0.059428268603539273, '2759': 0.17172645365323114, '33154': 5.0, '4751': 5.0, '561': 2.2191575281034726, '562': 3.753978051627641, '2037': 0.8162944821640523, '2049': 1.680084660175645, '1654': 0.4801322484101918, '200783': 4.166331421766525, '187857': 0.25456172918185765, '32069': 0.43224307793373856, '64898': 0.13193840732039142, '2713': 0.042648502424435415, '547': 0.042648502424435415, '206351': 0.43224307793373856, '481': 1.157097218991373, '482': 3.92803582109974, '2887326': 0.43224307793373856, '468': 3.1091444694250683, '469': 3.92803582109974, '117743': 0.25456172918185765, '200644': 0.43224307793373856, '49546': 3.8750612633917, '237': 0.042648502424435415, '83654': 0.042648502424435415, '118969': 0.43224307793373856, '444': 0.13193840732039142, '445': 0.7278322241038939, '745': 0.042648502424435415, '590': 0.042648502424435415, '909768': 5.0, '470': 0.059428268603539273, '81852': 0.13193840732039142, '1350': 2.1121630357519634, '1870884': 0.042648502424435415, '1496': 0.059428268603539273, '573': 0.059428268603539273, '72294': 0.13193840732039142, '194': 0.2416633558827686, '544448': 4.166331421766525, '31969': 0.43935045837568626, '2085': 0.43224307793373856, '2092': 0.13193840732039142, '2093': 0.042648502424435415, '747': 0.059428268603539273, '200795': 0.02666942833751868, '200930': 4.166331421766525, '1297': 0.02666942833751868, '65842': 0.02666942833751868, '1783257': 5.0, '203682': 0.02666942833751868, '203683': 0.25456172918185765, '112': 1.5903773704132833, '203691': 0.02666942833751868, '203692': 0.25456172918185765, '136': 0.8162944821640523, '666505': 0.25456172918185765, '666506': 3.6488033948702885, '666507': 3.8750612633917, '85018': 0.13193840732039142, '171550': 3.8750612633917, '1853228': 0.25456172918185765, '1853229': 0.43224307793373856, '563835': 0.13193840732039142, '768503': 0.25456172918185765, '768507': 0.43224307793373856, '89373': 0.13193840732039142, '2129': 0.042648502424435415, '1647': 0.042648502424435415, '197': 0.059428268603539273, '201': 0.059428268603539273, '135624': 0.43224307793373856, '83763': 0.13193840732039142, '186820': 0.13193840732039142, '1637': 0.042648502424435415, '1912216': 0.042648502424435415, '1747': 3.753978051627641, '2559073': 0.059428268603539273, '1346': 0.059428268603539273, '713': 0.2416633558827686, '416916': 0.042648502424435415, '714': 1.5345245145508304, '451864': 5.0, '5204': 0.02666942833751868, '452284': 0.9923039360362232, '1538075': 0.25456172918185765, '162474': 0.43224307793373856, '742845': 0.13193840732039142, '55193': 3.92803582109974, '4890': 0.02666942833751868, '716545': 5.0, '147538': 3.9956351945975497, '716546': 5.0, '715962': 5.0, '147541': 0.25456172918185765, '451867': 5.0, '5014': 0.43224307793373856, '1570301': 0.13193840732039142, '5579': 0.042648502424435415, '147537': 0.9923039360362232, '4891': 0.25456172918185765, '4892': 3.6488033948702885, '4893': 0.13193840732039142, '4930': 3.92803582109974, '451868': 5.0, '92860': 0.43224307793373856, '715340': 5.0, '683158': 0.13193840732039142, '104397': 0.2416633558827686, '37463': 0.042648502424435415, '2916678': 5.0, '766764': 0.13193840732039142, '1535325': 5.0, '5475': 0.042648502424435415, '5476': 0.059428268603539273, '5302': 0.9923039360362232, '155619': 0.25456172918185765, '452333': 5.0, '5338': 0.43224307793373856, '2982305': 5.0, '40562': 3.8750612633917, '109632': 0.042648502424435415, '29000': 3.9956351945975497, '162481': 0.25456172918185765, '231213': 0.43224307793373856, '1799696': 0.13193840732039142, '5533': 0.042648502424435415, '159987': 5.0, '213313': 0.042648502424435415, '715989': 5.0, '147550': 0.43935045837568626, '222543': 5.0, '5125': 0.43224307793373856, '110618': 1.680084660175645, '5506': 3.92803582109974, '355688': 5.0, '36064': 0.43224307793373856, '5250': 0.13193840732039142, '5251': 0.042648502424435415, '112252': 5.0, '1913637': 0.02666942833751868, '214504': 0.9923039360362232, '214506': 0.25456172918185765, '214509': 0.43224307793373856, '36753': 0.13193840732039142, '27382': 0.042648502424435415, '56487': 0.8162944821640523, '56488': 3.8750612633917, '56494': 0.2416633558827686, '155616': 0.25456172918185765, '5234': 0.43224307793373856, '1884633': 0.13193840732039142, '5206': 0.042648502424435415, '452335': 5.0, '68804': 0.43224307793373856, '90951': 0.13193840732039142, '311222': 
0.042648502424435415, '2985478': 5.0, '51005': 0.13193840732039142, '71941': 0.042648502424435415, '1538065': 0.43935045837568626, '1538066': 0.43224307793373856, '1538067': 0.13193840732039142, '64607': 0.042648502424435415, '68889': 0.8162944821640523, '227330': 5.0, '5368': 0.13193840732039142, '1487592': 5.0, '5369': 0.042648502424435415, '5257': 0.25456172918185765, '5267': 0.43224307793373856, '5268': 0.13193840732039142, '63298': 0.042648502424435415, '147548': 0.25456172918185765, '5120': 0.43224307793373856, '34371': 0.13193840732039142, '62701': 0.042648502424435415, '147545': 0.25456172918185765, '451871': 5.0, '5042': 0.43224307793373856, '1131492': 3.8750612633917, '5052': 0.4801322484101918, '2720870': 5.0, '162425': 0.059428268603539273, '104350': 0.13193840732039142, '178445': 2.1121630357519634, '1137986': 0.9923039360362232, '2212732': 0.25456172918185765, '214503': 0.43224307793373856, '4854': 0.13193840732039142, '4855': 0.042648502424435415, '1913638': 0.02666942833751868, '451828': 3.9956351945975497, '2219774': 5.0, '2219773': 0.43224307793373856, '2219775': 1.157097218991373, '304330': 3.92803582109974, '1156497': 0.13193840732039142, '4919': 0.4801322484101918, '474943': 0.13193840732039142, '45234': 0.042648502424435415, '34450': 0.13193840732039142, '34451': 0.042648502424435415, '2810619': 0.042648502424435415, '2726947': 0.43224307793373856, '93133': 0.13193840732039142, '41254': 0.042648502424435415, '90883': 0.43224307793373856, '1851551': 3.8750612633917, '29901': 0.042648502424435415, '227334': 5.0, '389951': 0.13193840732039142, '80744': 0.042648502424435415, '115784': 0.13193840732039142, '604195': 0.042648502424435415, '4903': 0.059428268603539273, '4909': 0.059428268603539273, '4926': 0.059428268603539273, '569360': 5.0, '5516': 3.753978051627641, '28569': 0.042648502424435415, '28556': 0.13193840732039142, '45301': 0.042648502424435415, '5598': 0.042648502424435415, '2499258': 5.0, '45303': 0.059428268603539273, '2726946': 0.43224307793373856, '452563': 0.13193840732039142, '237557': 0.042648502424435415, '90886': 0.43224307793373856, '5408': 0.13193840732039142, '5209': 0.042648502424435415, '5210': 3.753978051627641, '165808': 0.13193840732039142, '5410': 0.042648502424435415, '1851469': 1.5903773704132833, '1759442': 0.13193840732039142, '5552': 0.042648502424435415, '415704': 0.042648502424435415, '222544': 5.0, '5114': 0.43224307793373856, '5117': 0.13193840732039142, '83174': 2.2191575281034726, '252740': 0.059428268603539273, '117544': 0.042648502424435415, '448053': 0.059428268603539273, '5303': 0.43224307793373856, '5317': 0.13193840732039142, '5631': 0.042648502424435415, '5073': 0.4801322484101918, '5498': 2.2191575281034726, '64899': 0.6368896597615535, '36750': 1.5903773704132833, '36751': 0.13193840732039142, '4875': 0.042648502424435415, '668547': 0.13193840732039142, '237584': 0.042648502424435415, '64497': 0.042648502424435415, '1931355': 0.13193840732039142, '5318': 0.042648502424435415, '1851509': 0.042648502424435415, '100951': 0.059428268603539273, '5429': 0.042648502424435415, '5319': 0.059428268603539273, '77020': 0.059428268603539273, '119060': 0.13193840732039142, '106589': 0.042648502424435415, '2975441': 3.8750612633917, '196013': 0.042648502424435415, '210': 3.753978051627641, '28132': 0.059428268603539273, '2974257': 0.042648502424435415, '425941': 0.059428268603539273, '28135': 0.059428268603539273, '1283313': 0.4801322484101918, '76122': 3.753978051627641, '28131': 0.059428268603539273, '68805': 0.13193840732039142, '112985': 0.042648502424435415, '1449397': 0.059428268603539273, '45634': 0.059428268603539273, '301301': 0.059428268603539273, '85012': 0.43224307793373856, '83676': 3.8750612633917, '2013': 0.042648502424435415, '34372': 0.042648502424435415, '451507': 0.9923039360362232, '2212703': 0.25456172918185765, '4827': 0.43224307793373856, '1344963': 5.0, '34489': 0.13193840732039142, '4830': 3.92803582109974, '2720871': 5.0, '5061': 0.059428268603539273, '1921002': 0.43224307793373856, '2100208': 0.13193840732039142, '2100210': 3.92803582109974, '1629334': 0.059428268603539273, '72273': 0.43224307793373856, '2056687': 0.13193840732039142, '28905': 0.042648502424435415, '2570685': 5.0, '2026754': 0.059428268603539273, '446': 0.059428268603539273, '96229': 0.059428268603539273, '135618': 0.43224307793373856, '403': 0.13193840732039142, '413': 0.042648502424435415, '414': 0.059428268603539273, '135613': 0.43224307793373856, '72276': 0.13193840732039142, '414045': 0.042648502424435415, '414046': 0.059428268603539273, '48479': 5.0, '123258': 0.059428268603539273, '2887331': 0.13193840732039142, '661182': 0.042648502424435415, '392589': 0.059428268603539273, '245836': 0.059428268603539273, '1798710': 0.02666942833751868, '2211217': 0.43224307793373856, '213484': 0.042648502424435415, '758823': 3.753978051627641, '64493': 0.059428268603539273, '5020': 0.13193840732039142, '55067': 0.042648502424435415, '82517': 0.059428268603539273, '34373': 0.059428268603539273, '162454': 5.0, '159075': 0.042648502424435415, '148958': 0.059428268603539273, '222545': 5.0, '37989': 0.43224307793373856, '2033035': 0.13193840732039142, '42308': 0.042648502424435415, '1667166': 0.13193840732039142, '74721': 0.4801322484101918, '80390': 0.059428268603539273, '451870': 5.0, '34395': 0.43224307793373856, '1233474': 0.28181780977282767, '430999': 0.042648502424435415, '206542': 0.059428268603539273, '62131': 0.042648502424435415, '46472': 1.989869878627466, '69773': 2.0363075486253788, '1167584': 0.059428268603539273, '74722': 0.059428268603539273, '4932': 0.059428268603539273, '451866': 0.9923039360362232, '147554': 0.25456172918185765, '34346': 0.43224307793373856, '4894': 0.13193840732039142, '4895': 0.042648502424435415, '2720872': 5.0, '746128': 0.059428268603539273, '2014': 0.059428268603539273, '1283': 0.059428268603539273, '1311': 0.059428268603539273, '671232': 5.0, '1328': 0.059428268603539273, '38304': 0.059428268603539273, '204428': 4.166331421766525, '204429': 0.25456172918185765, '51291': 0.43224307793373856, '809': 0.13193840732039142, '1113537': 5.0, '810': 0.042648502424435415, '83558': 3.753978051627641, '135617': 0.13193840732039142, '85023': 0.13193840732039142, '33882': 0.7278322241038939, '1301283': 5.0, '1150': 0.43224307793373856, '1892249': 0.13193840732039142, '43988': 0.042648502424435415, '100883': 0.042648502424435415, '186329': 0.8162944821640523, '2146': 0.13193840732039142, '33926': 3.92803582109974, '2759736': 0.4801322484101918, '47715': 0.059428268603539273, '489': 0.059428268603539273, '12916': 3.92803582109974, '204455': 0.43224307793373856, '31989': 0.13193840732039142, '265': 0.042648502424435415, '212118': 0.042648502424435415, '1762': 3.1091444694250683, '1763': 0.042648502424435415, '85011': 0.43224307793373856, '2062': 0.13193840732039142, '1883': 0.042648502424435415, '285515': 0.059428268603539273, '74201': 0.02666942833751868, '203494': 0.25456172918185765, '48461': 0.43224307793373856, '1647988': 0.13193840732039142, '239934': 0.042648502424435415, '906': 0.042648502424435415, 
'265975': 0.042648502424435415, '118747': 0.042648502424435415, '52225': 0.042648502424435415, '1016': 3.92803582109974, '1017': 1.989869878627466, '1305': 0.059428268603539273, '1302': 0.059428268603539273, '1107316': 0.059428268603539273, '554406': 0.059428268603539273, '538': 0.042648502424435415, '539': 0.059428268603539273, '2845253': 0.13193840732039142, '157': 0.2416633558827686, '158': 2.0363075486253788, '53419': 0.059428268603539273, '82202': 0.042648502424435415, '82203': 0.059428268603539273, '69823': 0.059428268603539273, '620': 0.042648502424435415, '623': 0.059428268603539273, '1639': 0.059428268603539273, '28901': 0.059428268603539273, '135623': 0.43224307793373856, '641': 0.13193840732039142, '662': 2.552372207138855, '666': 0.059428268603539273, '1643824': 0.13193840732039142, '1380': 0.042648502424435415, '89583': 0.042648502424435415, '47420': 0.042648502424435415, '204457': 0.43224307793373856, '41297': 0.13193840732039142, '13687': 0.042648502424435415, '2767887': 0.042648502424435415, '1624': 0.059428268603539273, '2762318': 0.13193840732039142, '501783': 0.042648502424435415, '174708': 0.042648502424435415, '1651': 0.042648502424435415, '186822': 0.13193840732039142, '44249': 0.4801322484101918, '257758': 0.059428268603539273, '85010': 0.43224307793373856, '2070': 0.13193840732039142, '1847': 0.7278322241038939, '135614': 0.43224307793373856, '32033': 0.28181780977282767, '2782232': 5.0, '59732': 0.042648502424435415, '137': 3.8750612633917, '32008': 0.042648502424435415, '75682': 1.157097218991373, '119042': 5.0, '212791': 0.042648502424435415, '41294': 1.680084660175645, '28133': 0.059428268603539273, '2974251': 0.042648502424435415, '165179': 0.059428268603539273, '2805591': 0.13193840732039142, '2038': 0.2416633558827686, '2039': 0.059428268603539273, '1813': 0.042648502424435415, '2323': 5.0, '1783234': 5.0, '1783273': 5.0, '1794811': 5.0, '221216': 0.02666942833751868, '1853231': 0.13193840732039142, '283168': 0.042648502424435415, '204458': 0.43224307793373856, '76892': 3.1091444694250683, '41275': 0.042648502424435415, '820': 0.059428268603539273, '35832': 0.042648502424435415, '507': 0.042648502424435415, '511': 0.059428268603539273, '86661': 5.0, '1396': 0.059428268603539273, '1584': 0.059428268603539273, '256845': 0.02666942833751868, '574697': 0.042648502424435415, '1502': 0.059428268603539273, '239935': 0.059428268603539273, '1955630': 0.25456172918185765, '717963': 0.43224307793373856, '717964': 0.13193840732039142, '511745': 0.042648502424435415, '511746': 0.059428268603539273, '136845': 5.0, '303': 0.059428268603539273, '136843': 5.0, '294': 0.059428268603539273, '327575': 0.059428268603539273, '1019': 0.059428268603539273, '40323': 0.7278322241038939, '1903411': 0.13193840732039142, '613': 0.042648502424435415, '615': 0.059428268603539273, '995085': 5.0, '40324': 0.059428268603539273, '106633': 0.042648502424435415, '108010': 0.059428268603539273, '1351': 3.753978051627641, '150022': 0.042648502424435415, '1260': 0.059428268603539273, '43675': 0.059428268603539273, '1643685': 3.8750612633917, '138': 0.042648502424435415, '143': 0.059428268603539273, '186823': 0.13193840732039142, '29330': 0.042648502424435415, '206389': 0.43224307793373856, '2008795': 0.13193840732039142, '73029': 0.4801322484101918, '165696': 0.042648502424435415, '1685': 0.059428268603539273, '64895': 0.042648502424435415, '139': 0.059428268603539273, '459786': 0.042648502424435415, '239759': 3.92803582109974, '135619': 0.8162944821640523, '28256': 0.13193840732039142, '2745': 0.042648502424435415, '135622': 0.43224307793373856, '267890': 0.13193840732039142, '22': 0.042648502424435415, '75': 0.042648502424435415, '283': 2.1121630357519634, '162289': 0.7278322241038939, '146': 0.042648502424435415, '28037': 0.059428268603539273, '195950': 0.042648502424435415, '583': 2.552372207138855, '39778': 0.059428268603539273, '222': 0.4801322484101918, '2742598': 3.92803582109974, '1598': 3.753978051627641, '57037': 0.059428268603539273, '68892': 0.059428268603539273, '1579': 0.059428268603539273, '28025': 0.059428268603539273, '28890': 0.02666942833751868, '2283794': 5.0, '183925': 0.25456172918185765, '2158': 0.43224307793373856, '2159': 0.13193840732039142, '2172': 0.2416633558827686, '119852': 0.042648502424435415, '1261': 0.059428268603539273, '33033': 0.059428268603539273, '1335': 0.059428268603539273, '1308': 0.059428268603539273, '216816': 0.059428268603539273, '33959': 0.059428268603539273, '2790996': 0.43224307793373856, '2895623': 0.13193840732039142, '2995234': 0.042648502424435415, '2097': 0.059428268603539273, '629': 0.042648502424435415, '45401': 0.13193840732039142, '292632': 0.042648502424435415, '946234': 0.042648502424435415, '29393': 3.92803582109974, '580596': 0.042648502424435415, '2569097': 0.042648502424435415, '39488': 0.059428268603539273, '34104': 0.4801322484101918, '119603': 5.0, '1336': 0.059428268603539273, '225324': 1.5345245145508304, '135083': 0.059428268603539273, '416586': 0.059428268603539273, '29466': 0.059428268603539273, '1018': 0.059428268603539273, '1159323': 0.042648502424435415, '879969': 0.059428268603539273, '203': 0.059428268603539273, '32068': 0.042648502424435415, '826': 0.059428268603539273, '2529408': 0.042648502424435415, '29316': 0.059428268603539273, '396015': 0.059428268603539273, '35756': 0.059428268603539273, '649775': 0.25456172918185765, '649776': 0.43224307793373856, '649777': 0.13193840732039142, '2753': 0.042648502424435415, '74152': 0.02666942833751868, '28124': 0.059428268603539273, '28113': 0.059428268603539273, '671218': 0.059428268603539273, '113107': 1.5345245145508304, '439703': 0.059428268603539273, '46124': 0.059428268603539273, '1501332': 0.059428268603539273, '28137': 0.059428268603539273, '28129': 0.059428268603539273, '84109': 0.059428268603539273, '200': 0.059428268603539273, '218538': 3.753978051627641, '341694': 0.059428268603539273, '28136': 0.059428268603539273, '51160': 3.753978051627641, '143361': 0.059428268603539273, '354276': 5.0, '550': 0.059428268603539273, '172042': 0.059428268603539273, '77643': 5.0, '1773': 3.753978051627641, '963': 0.042648502424435415, '224471': 5.0, '114248': 0.042648502424435415, '28065': 0.042648502424435415, '88': 0.042648502424435415, '52972': 0.042648502424435415, '2895353': 5.0, '75654': 3.92803582109974, '82115': 0.13193840732039142, '227292': 5.0, '106591': 0.042648502424435415, '227290': 5.0, '379': 0.042648502424435415, '727': 0.059428268603539273, '475': 0.042648502424435415, '48736': 0.042648502424435415, '137838': 0.059428268603539273, '140625': 0.042648502424435415, '315405': 0.059428268603539273, '995019': 0.13193840732039142, '40544': 0.042648502424435415, '138117': 0.042648502424435415, '76777': 0.059428268603539273, '1313': 0.059428268603539273, '1481960': 0.042648502424435415, '2005519': 0.13193840732039142, '397864': 0.042648502424435415, '577310': 0.042648502424435415}
threshold = 0.1  # Adjust based on what "significantly high" means in your context

# Initialize NCBITaxa instance
ncbi = NCBITaxa()

# List to store selected keys
selected_keys = []

for key, value in weighteddict2.items():
    if value <= threshold:
        continue  # Skip if the value is not significantly high

    # Retrieve the taxonomic lineage for the current key
    lineage = ncbi.get_lineage(key)
    rank = ncbi.get_rank(lineage)
    if rank in ['kingdom', 'subkingdom', 'phylum', 'class', 'subclass', 'order']:
        continue
    # Compare with parent/descendants
    parent_value = max([weighteddict2.get(ancestor, -np.inf) for ancestor in lineage if ancestor != key])
    if value <= parent_value:
        continue  # Skip if the value is not higher than its parent/ancestors

    # Compare with sibling taxa
    siblings = [taxon for taxon in weighteddict2.keys() if ncbi.get_lineage(taxon)[:-1] == lineage[:-1]]
    sibling_values = [weighteddict2.get(sib) for sib in siblings if sib != key]

    if sibling_values and value <= max(sibling_values):
        continue  # Skip if the value is not higher than adjacent sibling taxa

    # If all conditions are satisfied, add the key to the selected keys
    selected_keys.append(key)

# Output the selected keys
print("Selected keys with significantly high values:")
for key in selected_keys:
    print(f"{key}: {weighteddict2[key]}")